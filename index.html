<script>
  const ADMIN_PASSWORD = "yourPasswordHere"; // âœ… è«‹æ”¹ç‚ºä½ è‡ªå·±çš„å¯†ç¢¼

  const sourceDB = "https://chesolutionsignup-default-rtdb.firebaseio.com/pendingUsers.json";
  const targetDB = "https://access-7a3c3-default-rtdb.firebaseio.com/users";

  function verifyPassword() {
    const input = document.getElementById("adminPass").value;
    if (input === ADMIN_PASSWORD) {
      document.getElementById("content").style.display = "block";
      loadData();
    } else {
      alert("å¯†ç¢¼éŒ¯èª¤");
    }
  }

  async function loadData() {
    const res = await fetch(sourceDB, {
      method: 'GET', 
      headers: {
        'Access-Control-Allow-Origin': 'https://woodyhu9512.github.io', // æ·»åŠ è·¨åŸŸå¤´éƒ¨
        'Content-Type': 'application/json'
      }
    });
    const data = await res.json();
    const container = document.getElementById("entries");
    container.innerHTML = "";

    if (!data) {
      container.innerHTML = "âœ… ç›®å‰æ²’æœ‰å¾…å¯©æ ¸è³‡æ–™";
      return;
    }

    Object.entries(data).forEach(([key, entry]) => {
      const div = document.createElement("div");
      div.className = "entry";

      const html = `
        <p><strong>å¸³è™Ÿï¼š</strong>${entry["ç”³è«‹å¸³è™Ÿ"]}</p>
        <p><strong>å¯†ç¢¼ï¼š</strong>${entry["ç”³è«‹å¯†ç¢¼"]}</p>
        <p><strong>å§“åï¼š</strong>${entry["çœŸå¯¦å§“å"]}</p>
        <p><strong>FBï¼š</strong>${entry["Facebookè³‡è¨Š"]}</p>
        <p><strong>éŠ€è¡Œå¾Œäº”ç¢¼ï¼š</strong>${entry["éŠ€è¡Œå¸³è™Ÿå¾Œäº”ç¢¼"]}</p>
        <p><strong>å­¸æ ¡ï¼š</strong>${entry["é¸æ“‡å­¸æ ¡"].join(", ")}</p>
        <p><strong>é‡‘é¡ï¼š</strong>${entry["ç¸½é‡‘é¡"]}</p>
        <p><strong>é€å‡ºæ™‚é–“ï¼š</strong>${entry["é€å‡ºæ™‚é–“"]}</p>
        <button onclick='approve("${key}", ${JSON.stringify(entry)})'>âœ… åŒæ„é€å‡º</button>
        <button onclick='remove("${key}")'>ğŸ—‘ï¸ åˆªé™¤æ­¤ç­†</button>
      `;
      div.innerHTML = html;
      container.appendChild(div);
    });
  }

  async function approve(key, entry) {
    const username = entry["ç”³è«‹å¸³è™Ÿ"];
    const payload = {
      password: entry["ç”³è«‹å¯†ç¢¼"],
      isLoggedIn: false,
      sessionToken: "",
      purchased: {}
    };
    entry["é¸æ“‡å­¸æ ¡"].forEach(s => payload.purchased[s] = true);

    await fetch(`${targetDB}/${username}.json`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    await remove(key);
  }

  async function remove(key) {
    await fetch(`https://chesolutionsignup-default-rtdb.firebaseio.com/pendingUsers/${key}.json`, {
      method: "DELETE"
    });
    loadData();
  }

  async function deleteAll() {
    if (!confirm("âš ï¸ ç¢ºå®šè¦åˆªé™¤æ‰€æœ‰è³‡æ–™å—ï¼Ÿé€™ç„¡æ³•å¾©åŸï¼")) return;
    await fetch("https://chesolutionsignup-default-rtdb.firebaseio.com/pendingUsers.json", {
      method: "DELETE"
    });
    loadData();
  }
</script>
